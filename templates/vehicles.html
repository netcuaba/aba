{% extends "base.html" %}

{% block title %}Qu·∫£n l√Ω xe - H·ªá th·ªëng qu·∫£n l√Ω v·∫≠n chuy·ªÉn{% endblock %}

{% block content %}
<div class="page-wrapper">
<h2 class="page-title">üöö Qu·∫£n l√Ω xe</h2>

<!-- Tab Navigation -->
<div class="sheet-tabs" style="margin-bottom: 25px;">
    <button type="button" class="sheet-tab active" onclick="switchTab('danh-sach-xe')" id="tab-danh-sach-xe">
        üìã Danh s√°ch xe
    </button>
    <button type="button" class="sheet-tab" onclick="switchTab('khoan-xe')" id="tab-khoan-xe">
        üöó Kho√°n xe
    </button>
</div>

<!-- Tab: Danh s√°ch xe -->
<div id="content-danh-sach-xe" class="tab-content active">
<!-- Button th√™m m·ªõi xe -->
<div style="margin-bottom: 20px;">
    <button type="button" class="btn btn-success" onclick="openAddVehicleModal()">
        ‚ûï Th√™m m·ªõi xe
    </button>
</div>

<h3 class="section-title">üìã Danh s√°ch xe</h3>
{% if vehicles %}
<div style="overflow-x: auto;">
    <table class="table">
        <thead>
            <tr>
                <th>STT</th>
                <th>Bi·ªÉn s·ªë xe</th>
                <th>Lo·∫°i xe</th>
                <th>T·∫£i tr·ªçng (KG)</th>
                <th>ƒê·ªãnh m·ª©c nhi√™n li·ªáu</th>
                <th>Ng√†y h·∫øt h·∫°n ƒëƒÉng ki·ªÉm</th>
                <th>S·ªï ƒëƒÉng ki·ªÉm</th>
                <th>Ng√†y h·∫øt h·∫°n ph√π hi·ªáu</th>
                <th>Ph√π hi·ªáu v·∫≠n t·∫£i</th>
                <th>Thao t√°c</th>
            </tr>
        </thead>
        <tbody>
            {% for vehicle in vehicles %}
            <tr>
                <td>{{ loop.index }}</td>
                <td style="white-space: nowrap;"><strong>{{ vehicle.license_plate }}</strong></td>
                <td>
                    <span style="padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; white-space: nowrap;
                                 {% if vehicle.vehicle_type == 'Xe Nh√†' %}background: #27ae60; color: white;{% else %}background: #3498db; color: white;{% endif %}">
                        {{ vehicle.vehicle_type or 'Xe Nh√†' }}
                    </span>
                </td>
                <td>{{ "{:,.0f}".format(vehicle.capacity) if vehicle.capacity else '0' }}</td>
                <td>
                    {% if vehicle.fuel_consumption %}
                        {% if vehicle.fuel_consumption == vehicle.fuel_consumption|int %}
                            {{ vehicle.fuel_consumption|int }} l√≠t
                        {% else %}
                            {{ vehicle.fuel_consumption }} l√≠t
                        {% endif %}
                    {% else %}
                        0 l√≠t
                    {% endif %}
                </td>
                <td>
                    {% if vehicle.inspection_expiry %}
                        {% set days_until_expiry = (vehicle.inspection_expiry - today).days %}
                        {% if days_until_expiry < 0 %}
                            <span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è H·∫øt h·∫°n</span>
                        {% elif days_until_expiry <= 30 %}
                            <span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è {{ vehicle.inspection_expiry.strftime('%d/%m/%Y') }}</span>
                        {% else %}
                            {{ vehicle.inspection_expiry.strftime('%d/%m/%Y') }}
                        {% endif %}
                    {% else %}
                        <span style="color: #95a5a6;">Ch∆∞a c·∫≠p nh·∫≠t</span>
                    {% endif %}
                </td>
                <td>
                    {% if vehicle.inspection_documents %}
                        <button type="button" class="btn btn-sm btn-info" onclick="viewInspectionDocuments({{ vehicle.id }})" style="padding: 5px 10px; font-size: 12px;">
                            Xem
                        </button>
                    {% else %}
                        <span style="color: #95a5a6;">Ch∆∞a c√≥</span>
                    {% endif %}
                </td>
                <td>
                    {% if vehicle.phu_hieu_expired_date %}
                        {% set days_until_expiry = (vehicle.phu_hieu_expired_date - today).days %}
                        {% if days_until_expiry < 0 %}
                            <span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è H·∫øt h·∫°n</span>
                        {% elif days_until_expiry <= 30 %}
                            <span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è {{ vehicle.phu_hieu_expired_date.strftime('%d/%m/%Y') }}</span>
                        {% else %}
                            {{ vehicle.phu_hieu_expired_date.strftime('%d/%m/%Y') }}
                        {% endif %}
                    {% else %}
                        <span style="color: #95a5a6;">Ch∆∞a c·∫≠p nh·∫≠t</span>
                    {% endif %}
                </td>
                <td>
                    {% if vehicle.phu_hieu_files %}
                        <button type="button" class="btn btn-sm btn-info" onclick="viewPhuHieuDocuments({{ vehicle.id }})" style="padding: 5px 10px; font-size: 12px;">
                            Xem
                        </button>
                    {% else %}
                        <span style="color: #95a5a6;">Ch∆∞a c√≥</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 5px; flex-wrap: nowrap; white-space: nowrap;">
                        <a href="/vehicles/edit/{{ vehicle.id }}" class="btn btn-sm btn-primary" style="padding: 5px 10px; font-size: 12px;">S·ª≠a</a>
                        <form method="post" action="/vehicles/delete/{{ vehicle.id }}" style="display: inline;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a xe n√†y?')">
                            <button type="submit" class="btn btn-sm btn-danger" style="padding: 5px 10px; font-size: 12px;">X√≥a</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div style="text-align: center; padding: 40px; color: #7f8c8d;">
    <h3>üöö Ch∆∞a c√≥ xe n√†o</h3>
    <p>H√£y th√™m xe ƒë·∫ßu ti√™n b·∫±ng n√∫t "Th√™m m·ªõi xe" b√™n tr√™n</p>
</div>
{% endif %}
</div>

<!-- Tab: Kho√°n xe -->
<div id="content-khoan-xe" class="tab-content" style="display: none;">
<!-- Button t·∫°o kho√°n xe -->
<div style="margin-bottom: 20px;">
    <button type="button" class="btn btn-success" onclick="openAddAssignmentModal()">
        ‚ûï T·∫°o b·∫£ng danh s√°ch kho√°n xe
    </button>
</div>

<h3 class="section-title">üìã Danh s√°ch kho√°n xe</h3>
<div style="overflow-x: auto;">
    <table class="table">
        <thead>
            <tr>
                <th>STT</th>
                <th>Bi·ªÉn s·ªë xe</th>
                <th>L√°i xe</th>
                <th>Ng√†y nh·∫≠n xe</th>
                <th>Ng√†y k·∫øt th√∫c</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
            </tr>
        </thead>
        <tbody id="assignmentsTableBody">
            {% for assignment in assignments %}
            <tr>
                <td>{{ loop.index }}</td>
                <td><strong>{{ assignment.vehicle.license_plate if assignment.vehicle else 'N/A' }}</strong></td>
                <td>{{ assignment.employee.name if assignment.employee else 'N/A' }}</td>
                <td>{{ assignment.assignment_date.strftime('%d/%m/%Y') if assignment.assignment_date else 'N/A' }}</td>
                <td>
                    {% if assignment.end_date %}
                        {{ assignment.end_date.strftime('%d/%m/%Y') }}
                    {% else %}
                        <span style="color: #27ae60; font-weight: bold;">ƒêang kho√°n</span>
                    {% endif %}
                </td>
                <td>
                    {% if assignment.end_date %}
                        <span style="padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; background: #95a5a6; color: white;">
                            ƒê√£ k·∫øt th√∫c
                        </span>
                    {% else %}
                        <span style="padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; background: #27ae60; color: white;">
                            ƒêang kho√°n
                        </span>
                    {% endif %}
                </td>
                <td>
                    {% if not assignment.end_date %}
                        <button type="button" class="btn btn-sm btn-warning" onclick="openTransferModal({{ assignment.id }}, {{ assignment.vehicle_id }}, '{{ assignment.vehicle.license_plate if assignment.vehicle else 'N/A' }}', {{ assignment.employee_id }}, '{{ assignment.employee.name if assignment.employee else 'N/A' }}', '{{ assignment.assignment_date.strftime('%Y-%m-%d') if assignment.assignment_date else '' }}')" style="padding: 5px 10px; font-size: 12px;">
                            üîÑ Thu h·ªìi / Chuy·ªÉn xe
                        </button>
                    {% else %}
                        <span style="color: #95a5a6;">-</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</div>

<!-- Modal th√™m xe m·ªõi -->
<div id="addVehicleModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3>‚ûï Th√™m xe m·ªõi</h3>
            <span class="close" onclick="closeAddVehicleModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="addVehicleForm" method="post" action="/vehicles/add" enctype="multipart/form-data">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="license_plate">Bi·ªÉn s·ªë xe *</label>
                        <input type="text" id="license_plate" name="license_plate" required placeholder="VD: 50H-448.42">
                    </div>
                    <div class="form-group">
                        <label for="vehicle_type">Lo·∫°i xe *</label>
                        <select id="vehicle_type" name="vehicle_type" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="Xe Nh√†" selected>Xe Nh√†</option>
                            <option value="Xe ƒê·ªëi t√°c">Xe ƒê·ªëi t√°c</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="capacity">T·∫£i tr·ªçng (kg) *</label>
                        <input type="number" id="capacity" name="capacity" step="100" required placeholder="VD: 5000">
                    </div>
                    <div class="form-group">
                        <label for="fuel_consumption">ƒê·ªãnh m·ª©c nhi√™n li·ªáu (l/100km)</label>
                        <input type="number" id="fuel_consumption" name="fuel_consumption" step="0.1" placeholder="VD: 25.5">
                    </div>
                    <div class="form-group">
                        <label for="inspection_expiry">Ng√†y h·∫øt h·∫°n ƒëƒÉng ki·ªÉm</label>
                        <input type="date" id="inspection_expiry" name="inspection_expiry">
                    </div>
                    <div class="form-group">
                        <label for="inspection_documents">Upload s·ªï ƒëƒÉng ki·ªÉm</label>
                        <input type="file" id="inspection_documents" name="inspection_documents" multiple accept=".pdf,.jpg,.jpeg,.png,.gif">
                        <small style="color: #7f8c8d;">C√≥ th·ªÉ ch·ªçn nhi·ªÅu ·∫£nh (PDF, JPG, PNG, GIF)</small>
                    </div>
                    <div class="form-group">
                        <label for="phu_hieu_expired_date">Ng√†y h·∫øt h·∫°n ph√π hi·ªáu v·∫≠n t·∫£i</label>
                        <input type="date" id="phu_hieu_expired_date" name="phu_hieu_expired_date">
                    </div>
                    <div class="form-group">
                        <label for="phu_hieu_files">Upload h√¨nh ·∫£nh ph√π hi·ªáu v·∫≠n t·∫£i</label>
                        <input type="file" id="phu_hieu_files" name="phu_hieu_files" multiple accept=".pdf,.jpg,.jpeg,.png,.gif">
                        <small style="color: #7f8c8d;">C√≥ th·ªÉ ch·ªçn nhi·ªÅu ·∫£nh (PDF, JPG, PNG, GIF)</small>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <div id="imagePreview" style="display: none; margin-top: 10px;">
                        <h4>Xem tr∆∞·ªõc ·∫£nh:</h4>
                        <div id="previewContainer" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
                    </div>
                </div>
                <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddVehicleModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-success">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal t·∫°o kho√°n xe -->
<div id="addAssignmentModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3>Danh s√°ch xe nh√†</h3>
            <span class="close" onclick="closeAddAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="addAssignmentForm">
                <div class="form-group">
                    <label for="assignment_vehicle_id">Xe *</label>
                    <select id="assignment_vehicle_id" name="vehicle_id" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">-- Ch·ªçn xe --</option>
                        {% for vehicle in available_vehicles %}
                        <option value="{{ vehicle.id }}">{{ vehicle.license_plate }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment_employee_id">L√°i xe *</label>
                    <select id="assignment_employee_id" name="employee_id" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">-- Ch·ªçn l√°i xe --</option>
                        {% for driver in drivers %}
                        <option value="{{ driver.id }}">{{ driver.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment_date">Ng√†y nh·∫≠n xe *</label>
                    <input type="date" id="assignment_date" name="assignment_date" required>
                </div>
                <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddAssignmentModal()">H·ªßy b·ªè</button>
                    <button type="submit" class="btn btn-success">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Thu h·ªìi / Chuy·ªÉn tr√°ch nhi·ªám xe -->
<div id="transferModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3>üîÑ Thu h·ªìi / Chuy·ªÉn tr√°ch nhi·ªám xe</h3>
            <span class="close" onclick="closeTransferModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="transferForm">
                <input type="hidden" id="transfer_assignment_id" name="assignment_id">
                <input type="hidden" id="transfer_vehicle_id" name="vehicle_id">
                <input type="hidden" id="transfer_old_employee_id" name="old_employee_id">
                
                <div class="form-group">
                    <label for="transfer_vehicle_display">1Ô∏è‚É£ Xe</label>
                    <input type="text" id="transfer_vehicle_display" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                </div>
                
                <div class="form-group">
                    <label for="transfer_old_driver_display">2Ô∏è‚É£ L√°i xe hi·ªán t·∫°i</label>
                    <input type="text" id="transfer_old_driver_display" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                    <small style="color: #27ae60; display: block; margin-top: 5px;">Tr·∫°ng th√°i: ƒêang l√†m vi·ªác</small>
                </div>
                
                <div class="form-group">
                    <label for="transfer_reason">3Ô∏è‚É£ L√Ω do thu h·ªìi üö® <span style="color: red;">*</span></label>
                    <select id="transfer_reason" name="transfer_reason" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                        <option value="">-- Ch·ªçn l√Ω do --</option>
                        <option value="Thi·∫øu tr√°ch nhi·ªám qu·∫£n l√Ω xe">Thi·∫øu tr√°ch nhi·ªám qu·∫£n l√Ω xe</option>
                        <option value="Hao d·∫ßu b·∫•t th∆∞·ªùng">Hao d·∫ßu b·∫•t th∆∞·ªùng</option>
                        <option value="Kh√¥ng b·∫£o d∆∞·ª°ng ƒë√∫ng quy ƒë·ªãnh">Kh√¥ng b·∫£o d∆∞·ª°ng ƒë√∫ng quy ƒë·ªãnh</option>
                        <option value="Vi ph·∫°m n·ªôi quy">Vi ph·∫°m n·ªôi quy</option>
                        <option value="Kh√°c">Kh√°c</option>
                    </select>
                    <textarea id="transfer_reason_other" name="transfer_reason_other" placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt (b·∫Øt bu·ªôc n·∫øu ch·ªçn 'Kh√°c')" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 80px; display: none;"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="transfer_end_date">4Ô∏è‚É£ Ng√†y k·∫øt th√∫c tr√°ch nhi·ªám c·ªßa l√°i xe c≈©</label>
                    <input type="date" id="transfer_end_date" name="end_date" required>
                </div>
                
                <div class="form-group">
                    <label for="transfer_new_employee_id">5Ô∏è‚É£ L√°i xe m·ªõi</label>
                    <select id="transfer_new_employee_id" name="new_employee_id" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">-- Ch·ªçn l√°i xe --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="transfer_new_assignment_date">6Ô∏è‚É£ Ng√†y nh·∫≠n xe c·ªßa l√°i xe m·ªõi</label>
                    <input type="date" id="transfer_new_assignment_date" name="new_assignment_date" required>
                </div>
                
                <div class="form-group">
                    <label for="transfer_internal_note">7Ô∏è‚É£ Ghi ch√∫ n·ªôi b·ªô (kh√¥ng b·∫Øt bu·ªôc)</label>
                    <textarea id="transfer_internal_note" name="internal_note" placeholder="Ghi ch√∫ d√πng cho qu·∫£n l√Ω" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 80px;"></textarea>
                </div>
                
                <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeTransferModal()">Hu·ª∑</button>
                    <button type="submit" class="btn btn-success">X√°c nh·∫≠n thu h·ªìi & chuy·ªÉn xe</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal xem s·ªï ƒëƒÉng ki·ªÉm -->
<div id="inspectionModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3>üìÑ S·ªï ƒëƒÉng ki·ªÉm</h3>
            <span class="close" onclick="closeInspectionModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="inspectionContent">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Modal xem ph√π hi·ªáu v·∫≠n t·∫£i -->
<div id="phuHieuModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3>üöõ Ph√π hi·ªáu v·∫≠n t·∫£i</h3>
            <span class="close" onclick="closePhuHieuModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="phuHieuContent">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
            </div>
        </div>
    </div>
</div>

<style>
.sheet-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.sheet-tab {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    background-color: #e9ecef;
    color: #495057;
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
}

.sheet-tab:hover {
    background-color: #dee2e6;
}

.sheet-tab.active {
    background-color: #3498db;
    color: #ffffff;
    font-weight: 600;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 0;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    border-radius: 10px 10px 0 0;
}

.modal-body {
    padding: 20px;
}

.modal-footer {
    padding: 20px;
    border-top: 1px solid #ddd;
    background: #f8f9fa;
    border-radius: 0 0 10px 10px;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #000;
}

.preview-image {
    max-width: 100px;
    max-height: 100px;
    object-fit: cover;
    border-radius: 5px;
    border: 2px solid #ddd;
}

.document-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 10px;
}

.document-item img {
    max-width: 80px;
    max-height: 80px;
    object-fit: cover;
    border-radius: 5px;
}

.document-info {
    flex: 1;
}

.document-actions {
    display: flex;
    gap: 5px;
}
</style>

<script>
// Tab switching
function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.sheet-tab').forEach(button => {
        button.classList.remove('active');
    });
    
    // Show selected tab content
    const selectedContent = document.getElementById('content-' + tabName);
    if (selectedContent) {
        selectedContent.classList.add('active');
        selectedContent.style.display = 'block';
    }
    
    // Add active class to selected tab button
    const selectedButton = document.getElementById('tab-' + tabName);
    if (selectedButton) {
        selectedButton.classList.add('active');
    }
    
    // Load assignments if switching to khoan-xe tab
    if (tabName === 'khoan-xe') {
        loadAssignments();
    }
}

// Load assignments data
async function loadAssignments() {
    try {
        const response = await fetch('/api/vehicles/assignments');
        const data = await response.json();
        
        if (data.success) {
            const tbody = document.getElementById('assignmentsTableBody');
            tbody.innerHTML = '';
            
            if (data.data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #7f8c8d;">Ch∆∞a c√≥ kho√°n xe n√†o</td></tr>';
            } else {
                data.data.forEach((assignment, index) => {
                    const row = document.createElement('tr');
                    
                    // Create cells
                    const cell1 = document.createElement('td');
                    cell1.textContent = index + 1;
                    
                    const cell2 = document.createElement('td');
                    const strong = document.createElement('strong');
                    strong.textContent = assignment.vehicle_license_plate || 'N/A';
                    cell2.appendChild(strong);
                    
                    const cell3 = document.createElement('td');
                    cell3.textContent = assignment.employee_name || 'N/A';
                    
                    const cell4 = document.createElement('td');
                    cell4.textContent = assignment.assignment_date || 'N/A';
                    
                    const cell5 = document.createElement('td');
                    if (assignment.end_date) {
                        cell5.textContent = assignment.end_date;
                    } else {
                        const span = document.createElement('span');
                        span.style.color = '#27ae60';
                        span.style.fontWeight = 'bold';
                        span.textContent = 'ƒêang kho√°n';
                        cell5.appendChild(span);
                    }
                    
                    const cell6 = document.createElement('td');
                    const statusSpan = document.createElement('span');
                    statusSpan.style.padding = '3px 8px';
                    statusSpan.style.borderRadius = '12px';
                    statusSpan.style.fontSize = '11px';
                    statusSpan.style.fontWeight = 'bold';
                    if (assignment.is_active) {
                        statusSpan.style.background = '#27ae60';
                        statusSpan.style.color = 'white';
                        statusSpan.textContent = 'ƒêang kho√°n';
                    } else {
                        statusSpan.style.background = '#95a5a6';
                        statusSpan.style.color = 'white';
                        statusSpan.textContent = 'ƒê√£ k·∫øt th√∫c';
                    }
                    cell6.appendChild(statusSpan);
                    
                    const cell7 = document.createElement('td');
                    if (assignment.is_active) {
                        const button = document.createElement('button');
                        button.type = 'button';
                        button.className = 'btn btn-sm btn-warning';
                        button.style.padding = '5px 10px';
                        button.style.fontSize = '12px';
                        button.textContent = 'üîÑ Thu h·ªìi / Chuy·ªÉn xe';
                        button.addEventListener('click', function(e) {
                            e.preventDefault();
                            console.log('Button clicked for assignment:', assignment);
                            if (typeof openTransferModal === 'function') {
                                openTransferModal(
                                    assignment.id,
                                    assignment.vehicle_id,
                                    assignment.vehicle_license_plate || 'N/A',
                                    assignment.employee_id,
                                    assignment.employee_name || 'N/A',
                                    assignment.assignment_date_raw || ''
                                );
                            } else {
                                console.error('openTransferModal is not a function');
                                alert('C√≥ l·ªói: H√†m openTransferModal kh√¥ng t·ªìn t·∫°i');
                            }
                        });
                        cell7.appendChild(button);
                    } else {
                        const span = document.createElement('span');
                        span.style.color = '#95a5a6';
                        span.textContent = '-';
                        cell7.appendChild(span);
                    }
                    
                    // Append all cells to row
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    row.appendChild(cell3);
                    row.appendChild(cell4);
                    row.appendChild(cell5);
                    row.appendChild(cell6);
                    row.appendChild(cell7);
                    
                    tbody.appendChild(row);
                });
            }
        }
    } catch (error) {
        console.error('L·ªói khi t·∫£i danh s√°ch kho√°n xe:', error);
    }
}

// Load available vehicles and drivers for assignment modal
async function loadAssignmentData() {
    try {
        const [vehiclesRes, driversRes] = await Promise.all([
            fetch('/api/vehicles/available'),
            fetch('/api/employees/drivers')
        ]);
        
        const vehiclesData = await vehiclesRes.json();
        const driversData = await driversRes.json();
        
        // Update vehicle dropdown
        const vehicleSelect = document.getElementById('assignment_vehicle_id');
        vehicleSelect.innerHTML = '<option value="">-- Ch·ªçn xe --</option>';
        if (vehiclesData.success && vehiclesData.data) {
            vehiclesData.data.forEach(vehicle => {
                const option = document.createElement('option');
                option.value = vehicle.id;
                option.textContent = vehicle.license_plate;
                vehicleSelect.appendChild(option);
            });
        }
        
        // Update driver dropdown
        const driverSelect = document.getElementById('assignment_employee_id');
        driverSelect.innerHTML = '<option value="">-- Ch·ªçn l√°i xe --</option>';
        if (driversData.success && driversData.data) {
            driversData.data.forEach(driver => {
                const option = document.createElement('option');
                option.value = driver.id;
                option.textContent = driver.name;
                driverSelect.appendChild(option);
            });
        }
    } catch (error) {
        console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
    }
}

// Assignment modal functions
function openAddAssignmentModal() {
    loadAssignmentData();
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('assignment_date').value = today;
    document.getElementById('addAssignmentModal').style.display = 'block';
}

function closeAddAssignmentModal() {
    document.getElementById('addAssignmentModal').style.display = 'none';
    document.getElementById('addAssignmentForm').reset();
}

// Handle assignment form submission
document.getElementById('addAssignmentForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
        vehicle_id: parseInt(formData.get('vehicle_id')),
        employee_id: parseInt(formData.get('employee_id')),
        assignment_date: formData.get('assignment_date')
    };
    
    try {
        const response = await fetch('/vehicles/assignments/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert(result.message || 'T·∫°o kho√°n xe th√†nh c√¥ng');
            closeAddAssignmentModal();
            loadAssignments();
            // Reload page to update available vehicles
            location.reload();
        } else {
            alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ t·∫°o kho√°n xe'));
        }
    } catch (error) {
        console.error('L·ªói khi t·∫°o kho√°n xe:', error);
        alert('C√≥ l·ªói x·∫£y ra khi t·∫°o kho√°n xe');
    }
});

function openAddVehicleModal() {
    document.getElementById('addVehicleModal').style.display = 'block';
}

function closeAddVehicleModal() {
    document.getElementById('addVehicleModal').style.display = 'none';
    document.getElementById('addVehicleForm').reset();
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('previewContainer').innerHTML = '';
}

function openInspectionModal() {
    document.getElementById('inspectionModal').style.display = 'block';
}

function closeInspectionModal() {
    document.getElementById('inspectionModal').style.display = 'none';
    document.getElementById('inspectionContent').innerHTML = '';
}

function openPhuHieuModal() {
    document.getElementById('phuHieuModal').style.display = 'block';
}

function closePhuHieuModal() {
    document.getElementById('phuHieuModal').style.display = 'none';
    document.getElementById('phuHieuContent').innerHTML = '';
}

// Transfer modal functions
async function openTransferModal(assignmentId, vehicleId, vehiclePlate, oldEmployeeId, oldEmployeeName, assignmentDate) {
    console.log('openTransferModal called with:', {assignmentId, vehicleId, vehiclePlate, oldEmployeeId, oldEmployeeName, assignmentDate});
    
    try {
        // Set hidden fields
        document.getElementById('transfer_assignment_id').value = assignmentId;
        document.getElementById('transfer_vehicle_id').value = vehicleId;
        document.getElementById('transfer_old_employee_id').value = oldEmployeeId;
    
    // Set readonly fields
    document.getElementById('transfer_vehicle_display').value = vehiclePlate;
    document.getElementById('transfer_old_driver_display').value = oldEmployeeName;
    
    // Set default dates
    const today = new Date().toISOString().split('T')[0];
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const tomorrowStr = tomorrow.toISOString().split('T')[0];
    
    document.getElementById('transfer_end_date').value = today;
    document.getElementById('transfer_new_assignment_date').value = tomorrowStr;
    
    // Load available drivers (excluding the old driver)
    try {
        const response = await fetch('/api/employees/drivers');
        const data = await response.json();
        
        const driverSelect = document.getElementById('transfer_new_employee_id');
        driverSelect.innerHTML = '<option value="">-- Ch·ªçn l√°i xe --</option>';
        
        if (data.success && data.data) {
            data.data.forEach(driver => {
                // Exclude the old driver (convert both to numbers for comparison)
                if (parseInt(driver.id) !== parseInt(oldEmployeeId)) {
                    const option = document.createElement('option');
                    option.value = driver.id;
                    option.textContent = driver.name;
                    driverSelect.appendChild(option);
                }
            });
        }
    } catch (error) {
        console.error('L·ªói khi t·∫£i danh s√°ch l√°i xe:', error);
    }
    
        // Reset form
        document.getElementById('transfer_reason').value = '';
        document.getElementById('transfer_reason_other').value = '';
        document.getElementById('transfer_reason_other').style.display = 'none';
        document.getElementById('transfer_internal_note').value = '';
        
        // Show modal
        const modal = document.getElementById('transferModal');
        if (modal) {
            modal.style.display = 'block';
            console.log('Modal displayed');
        } else {
            console.error('transferModal element not found');
        }
    } catch (error) {
        console.error('Error in openTransferModal:', error);
        alert('C√≥ l·ªói x·∫£y ra khi m·ªü form thu h·ªìi/chuy·ªÉn xe: ' + error.message);
    }
}

function closeTransferModal() {
    document.getElementById('transferModal').style.display = 'none';
    document.getElementById('transferForm').reset();
}

// Handle transfer reason dropdown change
document.getElementById('transfer_reason').addEventListener('change', function() {
    const otherTextarea = document.getElementById('transfer_reason_other');
    if (this.value === 'Kh√°c') {
        otherTextarea.style.display = 'block';
        otherTextarea.required = true;
    } else {
        otherTextarea.style.display = 'none';
        otherTextarea.required = false;
        otherTextarea.value = '';
    }
});

// Handle date validation
document.getElementById('transfer_end_date').addEventListener('change', function() {
    const endDate = new Date(this.value);
    const newAssignmentDate = document.getElementById('transfer_new_assignment_date');
    const newDate = new Date(newAssignmentDate.value);
    
    if (newDate < endDate) {
        // If new assignment date is before end date, set it to the day after end date
        const nextDay = new Date(endDate);
        nextDay.setDate(nextDay.getDate() + 1);
        newAssignmentDate.value = nextDay.toISOString().split('T')[0];
    }
    
    // Set min date for new assignment date
    const minDate = new Date(endDate);
    minDate.setDate(minDate.getDate() + 1);
    newAssignmentDate.min = minDate.toISOString().split('T')[0];
});

document.getElementById('transfer_new_assignment_date').addEventListener('change', function() {
    const newDate = new Date(this.value);
    const endDate = document.getElementById('transfer_end_date');
    const endDateValue = new Date(endDate.value);
    
    if (newDate <= endDateValue) {
        alert('Ng√†y nh·∫≠n xe c·ªßa l√°i xe m·ªõi ph·∫£i l·ªõn h∆°n ng√†y k·∫øt th√∫c tr√°ch nhi·ªám c·ªßa l√°i xe c≈©');
        // Set to the day after end date
        const nextDay = new Date(endDateValue);
        nextDay.setDate(nextDay.getDate() + 1);
        this.value = nextDay.toISOString().split('T')[0];
    }
    
    // Set max date for end date
    const maxDate = new Date(newDate);
    maxDate.setDate(maxDate.getDate() - 1);
    endDate.max = maxDate.toISOString().split('T')[0];
});

// Handle transfer form submission
document.getElementById('transferForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const transferReason = document.getElementById('transfer_reason').value;
    const transferReasonOther = document.getElementById('transfer_reason_other').value;
    
    // Validate transfer reason
    if (!transferReason) {
        alert('Vui l√≤ng ch·ªçn l√Ω do thu h·ªìi');
        return;
    }
    
    if (transferReason === 'Kh√°c' && !transferReasonOther.trim()) {
        alert('Vui l√≤ng nh·∫≠p m√¥ t·∫£ chi ti·∫øt khi ch·ªçn l√Ω do "Kh√°c"');
        return;
    }
    
    // Build final transfer reason
    const finalReason = transferReason === 'Kh√°c' ? transferReasonOther : transferReason;
    
    const data = {
        assignment_id: parseInt(document.getElementById('transfer_assignment_id').value),
        vehicle_id: parseInt(document.getElementById('transfer_vehicle_id').value),
        old_employee_id: parseInt(document.getElementById('transfer_old_employee_id').value),
        transfer_reason: finalReason,
        end_date: document.getElementById('transfer_end_date').value,
        new_employee_id: parseInt(document.getElementById('transfer_new_employee_id').value),
        new_assignment_date: document.getElementById('transfer_new_assignment_date').value,
        internal_note: document.getElementById('transfer_internal_note').value
    };
    
    // Validate dates
    const endDate = new Date(data.end_date);
    const newAssignmentDate = new Date(data.new_assignment_date);
    
    if (newAssignmentDate <= endDate) {
        alert('Ng√†y nh·∫≠n xe c·ªßa l√°i xe m·ªõi ph·∫£i l·ªõn h∆°n ng√†y k·∫øt th√∫c tr√°ch nhi·ªám c·ªßa l√°i xe c≈©');
        return;
    }
    
    try {
        const response = await fetch('/vehicles/assignments/transfer', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert(result.message || 'Thu h·ªìi v√† chuy·ªÉn xe th√†nh c√¥ng');
            closeTransferModal();
            loadAssignments();
            // Reload page to update data
            location.reload();
        } else {
            alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ th·ª±c hi·ªán thu h·ªìi v√† chuy·ªÉn xe'));
        }
    } catch (error) {
        console.error('L·ªói khi thu h·ªìi v√† chuy·ªÉn xe:', error);
        alert('C√≥ l·ªói x·∫£y ra khi thu h·ªìi v√† chuy·ªÉn xe');
    }
});

// Xem tr∆∞·ªõc ·∫£nh khi ch·ªçn file
document.getElementById('inspection_documents').addEventListener('change', function(e) {
    const files = e.target.files;
    const previewContainer = document.getElementById('previewContainer');
    const imagePreview = document.getElementById('imagePreview');
    
    previewContainer.innerHTML = '';
    
    if (files.length > 0) {
        imagePreview.style.display = 'block';
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'preview-image';
                    img.title = file.name;
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }
    } else {
        imagePreview.style.display = 'none';
    }
});

// Xem s·ªï ƒëƒÉng ki·ªÉm
async function viewInspectionDocuments(vehicleId) {
    try {
        console.log(`DEBUG: Loading documents for vehicle ID: ${vehicleId}`);
        const response = await fetch(`/vehicles/documents/${vehicleId}`);
        const data = await response.json();
        
        console.log('DEBUG: API response:', data);
        
        const content = document.getElementById('inspectionContent');
        
        if (!data.success) {
            content.innerHTML = `<p style="text-align: center; color: #e74c3c; padding: 20px;">
                <i class="fas fa-exclamation-triangle"></i><br>
                <strong>L·ªói:</strong> ${data.error || 'Kh√¥ng th·ªÉ t·∫£i s·ªï ƒëƒÉng ki·ªÉm'}
            </p>`;
            openInspectionModal();
            return;
        }
        
        if (data.documents && data.documents.length > 0) {
            let html = '<div class="documents-list">';
            let hasValidDocuments = false;
            
            data.documents.forEach(doc => {
                console.log(`DEBUG: Processing document: ${doc.filename}, exists: ${doc.exists}`);
                
                if (doc.exists) {
                    hasValidDocuments = true;
                    html += `
                        <div class="document-item">
                            ${doc.extension === '.pdf' ? 
                                `<div style="width: 80px; height: 80px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                                    <span style="font-size: 24px;">üìÑ</span>
                                </div>` :
                                `<img src="${doc.url}" alt="${doc.filename}" style="max-width: 200px; max-height: 200px; border-radius: 5px;" onerror="this.onerror=null; this.parentElement.innerHTML='<div style=\\'width: 80px; height: 80px; background: #fee; display: flex; align-items: center; justify-content: center; border-radius: 5px;\\'><span style=\\'font-size: 24px;\\'>‚ö†Ô∏è</span></div>'">`
                            }
                            <div class="document-info">
                                <strong>${doc.filename}</strong><br>
                                <small>K√≠ch th∆∞·ªõc: ${doc.size ? (doc.size / 1024).toFixed(1) + ' KB' : 'N/A'}</small>
                            </div>
                            <div class="document-actions">
                                <a href="${doc.url}" target="_blank" class="btn btn-sm btn-primary">Xem</a>
                                <button type="button" class="btn btn-sm btn-danger" onclick="deleteDocument(${vehicleId}, '${doc.filename.replace(/'/g, "\\'")}')">X√≥a</button>
                            </div>
                        </div>
                    `;
                } else {
                    // Hi·ªÉn th·ªã file kh√¥ng t·ªìn t·∫°i v·ªõi th√¥ng b√°o r√µ r√†ng
                    html += `
                        <div class="document-item" style="opacity: 0.7; border-left: 3px solid #e74c3c;">
                            <div style="width: 80px; height: 80px; background: #fee; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                                <span style="font-size: 24px;">‚ö†Ô∏è</span>
                            </div>
                            <div class="document-info">
                                <strong>${doc.filename}</strong><br>
                                <small style="color: #e74c3c;">
                                    <i class="fas fa-exclamation-triangle"></i> ${doc.error || 'File kh√¥ng t·ªìn t·∫°i'}
                                </small>
                            </div>
                            <div class="document-actions">
                                <button type="button" class="btn btn-sm btn-danger" onclick="deleteDocument(${vehicleId}, '${doc.filename.replace(/'/g, "\\'")}')">X√≥a kh·ªèi danh s√°ch</button>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            
            if (!hasValidDocuments && data.documents.length > 0) {
                html += '<p style="text-align: center; color: #e74c3c; padding: 10px; margin-top: 10px; background: #fee; border-radius: 5px;"><i class="fas fa-exclamation-triangle"></i> T·∫•t c·∫£ file ƒë·ªÅu kh√¥ng t·ªìn t·∫°i tr√™n server. Vui l√≤ng upload l·∫°i.</p>';
            }
            
            content.innerHTML = html;
        } else {
            content.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 20px;"><i class="fas fa-file-alt"></i><br>Ch∆∞a c√≥ s·ªï ƒëƒÉng ki·ªÉm n√†o</p>';
        }
        
        openInspectionModal();
    } catch (error) {
        console.error('L·ªói khi t·∫£i s·ªï ƒëƒÉng ki·ªÉm:', error);
        const content = document.getElementById('inspectionContent');
        content.innerHTML = `<p style="text-align: center; color: #e74c3c; padding: 20px;">
            <i class="fas fa-exclamation-triangle"></i><br>
            <strong>L·ªói:</strong> C√≥ l·ªói x·∫£y ra khi t·∫£i s·ªï ƒëƒÉng ki·ªÉm<br>
            <small>${error.message || 'Vui l√≤ng th·ª≠ l·∫°i sau'}</small>
        </p>`;
        openInspectionModal();
    }
}

// Xem ph√π hi·ªáu v·∫≠n t·∫£i
async function viewPhuHieuDocuments(vehicleId) {
    try {
        const response = await fetch(`/vehicles/phu-hieu-documents/${vehicleId}`);
        const data = await response.json();
        
        const content = document.getElementById('phuHieuContent');
        
        if (data.success && data.documents.length > 0) {
            let html = '<div class="documents-list">';
            
            data.documents.forEach(doc => {
                if (doc.exists) {
                    html += `
                        <div class="document-item">
                            ${doc.extension === '.pdf' ? 
                                `<div style="width: 80px; height: 80px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                                    <span style="font-size: 24px;">üìÑ</span>
                                </div>` :
                                `<img src="${doc.url}" alt="${doc.filename}" onerror="this.style.display='none'">`
                            }
                            <div class="document-info">
                                <strong>${doc.filename}</strong><br>
                                <small>K√≠ch th∆∞·ªõc: ${(doc.size / 1024).toFixed(1)} KB</small>
                            </div>
                            <div class="document-actions">
                                <a href="${doc.url}" target="_blank" class="btn btn-sm btn-primary">Xem</a>
                                <button type="button" class="btn btn-sm btn-danger" onclick="deletePhuHieuDocument(${vehicleId}, '${doc.filename}')">X√≥a</button>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            content.innerHTML = html;
        } else {
            content.innerHTML = '<p style="text-align: center; color: #7f8c8d;">Ch∆∞a c√≥ ph√π hi·ªáu v·∫≠n t·∫£i n√†o</p>';
        }
        
        openPhuHieuModal();
    } catch (error) {
        console.error('L·ªói khi t·∫£i ph√π hi·ªáu v·∫≠n t·∫£i:', error);
        alert('C√≥ l·ªói x·∫£y ra khi t·∫£i ph√π hi·ªáu v·∫≠n t·∫£i');
    }
}

// X√≥a s·ªï ƒëƒÉng ki·ªÉm
async function deleteDocument(vehicleId, filename) {
    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a file n√†y?')) {
        return;
    }
    
    try {
        const response = await fetch(`/vehicles/documents/${vehicleId}?filename=${encodeURIComponent(filename)}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('X√≥a file th√†nh c√¥ng');
            location.reload();
        } else {
            alert('L·ªói: ' + data.error);
        }
    } catch (error) {
        console.error('L·ªói khi x√≥a file:', error);
        alert('C√≥ l·ªói x·∫£y ra khi x√≥a file');
    }
}

// X√≥a ph√π hi·ªáu v·∫≠n t·∫£i
async function deletePhuHieuDocument(vehicleId, filename) {
    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a file n√†y?')) {
        return;
    }
    
    try {
        const response = await fetch(`/vehicles/phu-hieu-documents/${vehicleId}?filename=${encodeURIComponent(filename)}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('X√≥a file th√†nh c√¥ng');
            location.reload();
        } else {
            alert('L·ªói: ' + data.error);
        }
    } catch (error) {
        console.error('L·ªói khi x√≥a file:', error);
        alert('C√≥ l·ªói x·∫£y ra khi x√≥a file');
    }
}

// ƒê√≥ng modal khi click b√™n ngo√†i
window.onclick = function(event) {
    const addModal = document.getElementById('addVehicleModal');
    const inspectionModal = document.getElementById('inspectionModal');
    const phuHieuModal = document.getElementById('phuHieuModal');
    const assignmentModal = document.getElementById('addAssignmentModal');
    const transferModal = document.getElementById('transferModal');
    
    if (event.target === addModal) {
        closeAddVehicleModal();
    }
    if (event.target === inspectionModal) {
        closeInspectionModal();
    }
    if (event.target === phuHieuModal) {
        closePhuHieuModal();
    }
    if (event.target === assignmentModal) {
        closeAddAssignmentModal();
    }
    if (event.target === transferModal) {
        closeTransferModal();
    }
}
</script>
</div>
{% endblock %}
